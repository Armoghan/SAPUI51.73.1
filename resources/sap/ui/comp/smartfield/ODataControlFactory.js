/*
 * SAPUI5

		(c) Copyright 2009-2019 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/core/library","sap/m/library","sap/ui/comp/library","sap/ui/model/BindingMode","sap/m/TextArea","sap/m/Link","sap/m/CheckBox","sap/m/ComboBox","sap/m/DatePicker","sap/m/DateTimePicker","sap/m/FlexItemData","sap/m/HBox","sap/m/Input","sap/m/Select","sap/m/Text","sap/ui/core/Renderer","sap/ui/comp/navpopover/SmartLink","./ControlFactoryBase","./FieldControl","./ODataControlSelector","./ODataHelper","./ODataTypes","./TextArrangementDelegate","sap/m/ObjectNumber","sap/m/ObjectIdentifier","sap/m/ObjectStatus","sap/m/TimePicker","sap/ui/comp/navpopover/SemanticObjectController","sap/ui/comp/util/FormatUtil","sap/ui/comp/smartfield/Configuration","sap/ui/comp/odata/MetadataAnalyser","sap/ui/comp/navpopover/NavigationPopoverHandler","sap/ui/core/InvisibleText","sap/base/Log","sap/base/assert","sap/base/security/URLWhitelist","sap/base/util/merge","sap/base/strings/capitalize"],function(c,m,l,B,T,L,C,a,D,b,F,H,I,S,d,R,e,f,g,O,h,i,j,k,o,p,q,r,s,t,M,N,u,v,w,U,x,y){"use strict";var V=c.ValueState;var z=c.TextAlign;var A=m.InputType;var E=m.FlexJustifyContent;var G=l.smartfield.CriticalityRepresentationType;var J=l.smartfield.ControlContextType;var K=c.TextDirection;var P=m.FlexAlignContent;var Q;var W=f.extend("sap.ui.comp.smartfield.ODataControlFactory",{constructor:function(n,X,Y){f.call(this,n,X);this.sName="ODataControlFactory";this._oMetaData={annotations:{}};this._oMeta=Y;this._oHelper=new h(n,this._oBinding);this._oFieldControl=new g(X,this._oHelper);this._oTypes=new i(X);this._oSelector=new O(this._oMetaData,X,this._oTypes);this.oTextArrangementDelegate=new j(this);this._bInitialized=false;this.bPending=false;this._oAmountInputFlexItemData=null;this._oUOMInputFlexItemData=null;this._oUOMTextFlexItemData=null;this.oMeasureField=null;Q=sap.ui.require("sap/ui/comp/smartfield/SmartField");if(!Q){throw new Error("SmartField module not loaded for "+this);}}});W.prototype._init=function(n){this._oMetaData.model=n.model;this._oMetaData.path=n.path;this._oMetaData.entitySet=n.entitySetObject||this._oHelper.oMeta.getODataEntitySet(n.entitySet);if(this._oHelper.oMeta){w(this._oMetaData.entitySet,'The entity set named "'+n.entitySet+'" was not found in the "'+this._oHelper.oMeta.getODataEntityContainer().name+'" entity container of the service metadata document. - '+this.getMetadata().getName());}this._oMetaData.entityType=n.entityType||this._oHelper.oMeta.getODataEntityType(this._oMetaData.entitySet.entityType);this._oMetaData.navigationPath=n.navigationPath||null;if(this._oModel){this._oHelper.checkNavigationProperty(this._oMetaData,this._oParent);this._oHelper.getProperty(this._oMetaData);var X=this.getEdmProperty();w(!!X,'The EDM property "'+n.path+'" was not found in the "'+this._oMetaData.entityType.namespace+"."+this._oMetaData.entityType.name+'" entity type. - '+this.getMetadata().getName());if(X){this._oMetaData.annotations.text=this._oHelper.getTextProperty2(this._oMetaData);this._oMetaData.annotations.uom=this._oHelper.getUnitOfMeasure2(this._oMetaData);this._oHelper.getValueListData(this._oMetaData);this._oMetaData.annotations.lineitem=this._oHelper.getAnalyzer().getLineItemAnnotation(this._oMetaData.entitySet.entityType);this._oHelper.getUOMValueListAnnotationPath(this._oMetaData);this._oMetaData.annotations.semantic=M.getSemanticObjectsFromProperty(X);this._oMetaData.annotations.semanticKeys=this._oHelper.getAnalyzer().getSemanticKeyAnnotation(this._oMetaData.entitySet.entityType);if(this._oMetaData.annotations.uom){this._oMetaData.annotations.uom.annotations={};this._oHelper.getValueListData(this._oMetaData.annotations.uom);}this._oHelper.getUOMTextAnnotation(this._oMetaData);if(this._oParent&&this._oParent.getExpandNavigationProperties()){var Y=this._oParent.getBindingContext(),Z=Y&&Y.getObject(),$=Z&&Z.__metadata.created;if(!$){var _=this._oHelper.getAutoExpandProperties(X);if(_.length>0){this._oParent.bindElement({path:"",parameters:{expand:_,select:_}});}}}}}else{this._oMetaData.modelObject=n.modelObject;this._oMetaData.property=n.property;this._oMetaData.property.valueListAnnotation=null;this._oMetaData.property.valueListKeyProperty=null;this._oMetaData.property.valueListEntitySet=null;this._oMetaData.property.valueListEntityType=null;this._oMetaData.annotations.text=n.annotations.text;this._oMetaData.annotations.uom=n.annotations.uom;if(this._oMetaData.annotations.uom&&!this._oMetaData.annotations.uom.annotations){this._oMetaData.annotations.uom.annotations={};}this._oMetaData.annotations.valuelist=n.annotations.valuelist;this._oMetaData.annotations.valuelistType=n.annotations.valuelistType;this._oMetaData.annotations.lineitem=n.annotations.lineitem;this._oMetaData.annotations.semantic=n.annotations.semantic;this._oMetaData.annotations.valuelistuom=n.annotations.valuelistuom;}};W.prototype._initValueList=function(n){var X=this._oMetaData.property,Y=n.primaryValueListAnnotation;this._oMetaData.annotations.valueListData=Y;X.valueListAnnotation=Y;X.valueListKeyProperty=this._oHelper.getODataValueListKeyProperty(Y);X.valueListEntitySet=this._oHelper.oMeta.getODataEntitySet(Y.valueListEntitySetName);X.valueListEntityType=this._oHelper.oMeta.getODataEntityType(this._oHelper.oMeta.getODataEntitySet(Y.valueListEntitySetName).entityType);};W.prototype._createEdmDisplay=function(){var n,X,Y,Z,$=this,_={width:true,textAlign:true},a1=this.getEdmProperty();if(a1){Z=this._oHelper.oAnnotation.getText(a1);}var b1=this._oParent.data("configdata");var c1=((b1&&(b1.isInnerControl!==true))||this._oParent.isContextTable());var d1=this._oSelector.checkComboBox(c1);if(d1.combobox&&(this._oParent.getFetchValueListReadOnly()||(Z===undefined))){return this._createComboBox({valueHelp:{annotation:d1.annotation,noDialog:true,noTypeAhead:true},edit:false});}if(this._checkLink()&&!this._oSelector.useObjectIdentifier()){return this._createLink();}var e1=this.createAttributes(null,this._oMetaData.property,_),f1=this._oSelector.checkDatePicker()||(a1?a1.type.startsWith("Edm.Date"):false);this.oType=null;if(f1){var g1=this.getFormatSettings("dateFormatSettings");this.oType=this._oTypes.getType(this._oMetaData.property,g1,{displayFormat:"Date"});e1.text={model:this._oMetaData.model,path:this._oMetaData.path,type:this.oType};}else{this.oType=this._oTypes.getType(this._oMetaData.property);e1.text={model:this._oMetaData.model,path:this._oHelper.getEdmDisplayPath(this._oMetaData),type:this.oType};}if(a1){X=this._oHelper.oAnnotation.isMasked(a1);if(X){e1.text.formatter=i.maskValue;}if(Z){Y=this._oSelector.useObjectIdentifier(f1,X);if(Y){delete e1.width;delete e1.textAlign;e1.text={path:this._oMetaData.path};e1.title={path:this._oHelper.getEdmDisplayPath(this._oMetaData)};if(this._oParent.hasListeners("press")){e1.titleActive=true;e1.titlePress=function(l1){$._oParent.firePress(l1);};}else if(this._oMetaData.annotations.semantic&&this._oMetaData.annotations.semantic.defaultSemanticObject){var h1;var i1;var j1=this._oMetaData.annotations.semantic.additionalSemanticObjects.concat(this._oMetaData.annotations.semantic.defaultSemanticObject);r.getDistinctSemanticObjects().then(function(l1){h1=r.hasDistinctSemanticObject(j1,l1);if(h1){var m1=$._oParent.getBindingInfo("value");var n1=m1.parts[0].path;var o1=$._oHelper.oAnnotation.getLabel($._oMetaData.property.property);if($._oMetaData.annotations.lineitem&&$._oMetaData.annotations.lineitem.labels&&$._oMetaData.annotations.lineitem.labels[n1]){o1=$._oMetaData.annotations.lineitem.labels[n1];}i1=new N({semanticObject:$._oMetaData.annotations.semantic.defaultSemanticObject,additionalSemanticObjects:$._oMetaData.annotations.semantic.additionalSemanticObjects,semanticObjectLabel:o1,fieldName:n1,navigationTargetsObtained:function(p1){var q1=sap.ui.getCore().byId(p1.getSource().getControl());var r1=p1.getParameters().mainNavigation;if(r1){r1.setDescription(q1.getText());}p1.getParameters().show(q1.getTitle(),r1,undefined,undefined);}});}});e1.titleActive={path:"$sapuicompsmartfield_distinctSO>/distinctSemanticObjects",formatter:function(l1){return r.hasDistinctSemanticObject(j1,l1);}};e1.titlePress=function(l1){if(h1&&i1){i1.setControl(l1.getSource(l1.getParameter("domRef")));i1.openPopover();}};}}else if(!(b1&&(b1.isInnerControl===true))){e1.text={};e1.text.parts=[];e1.text.parts.push(this._oMetaData.path);e1.text.parts.push(this._oHelper.getEdmDisplayPath(this._oMetaData));e1.text.formatter=function(l1,m1){if(d1.combobox){return $._formatDisplayBehaviour("defaultComboBoxReadOnlyDisplayBehaviour",l1,m1);}if($.oType){l1=$.oType.formatValue(l1,"string");}return $._formatDisplayBehaviour("defaultInputFieldDisplayBehaviour",l1,m1);};}}else if(this._oSelector.checkCheckBox()){e1.text.formatter=function(l1){return $._formatDisplayBehaviour("defaultCheckBoxDisplayBehaviour",l1);};}}if(Y){n=new o(this._oParent.getId()+"-objIdentifier",e1);if(this._oMetaData.annotations.semantic){n.setModel(r.getJSONModel(),"$sapuicompsmartfield_distinctSO");}}else{if(e1.text.type&&e1.text.type.isA("sap.ui.comp.smartfield.type.DateTime")&&e1.text.type.oConstraints&&e1.text.type.oConstraints.isDateOnly){e1.wrapping=false;}if(this._oParent.isContextTable()&&sap.ui.getCore().getConfiguration().getRTL()){e1.textDirection="LTR";}n=new d(this._oParent.getId()+"-text",e1);}if(!Y&&b1&&b1.configdata&&b1.configdata.onText){b1.configdata.onText(n);}var k1={control:n,onCreate:"_onCreate",params:{getValue:"getText",noValidations:true,type:null}};if(this.oType){k1.type={type:this.oType,property:this._oMetaData.property};}return k1;};W.prototype._createEdmTime=function(){var n={width:true,placeholder:true,valueState:true,valueStateText:true};var X=W.getBoundPropertiesMapInfoForControl(q.getMetadata().getName(),{propertyName:"value"})[0];var Y={valueFormat:"HH:mm:ss"};Y=Object.assign(Y,this.createAttributes(X,this._oMetaData.property,n,{event:"change"}));if(Y.width===""){Y.width="100%";}var Z=new q(this._oParent.getId()+"-timePicker",Y);return{control:Z,onCreate:"_onCreate",params:{getValue:"getValue",type:{type:Y.value.type,property:this._oMetaData.property}}};};W.prototype._createObjectStatus=function(){var n=this.createAttributes(null,this._oMetaData.property,null),X=this._oHelper.oAnnotation.getText(this.getEdmProperty());var Y=W.getBoundPropertiesMapInfoForControl(p.getMetadata().getName(),{propertyName:"value"})[0];if(X){n[Y]={parts:[this._oHelper.getEdmDisplayPath(this._oMetaData)]};}else{n[Y]={model:this._oMetaData.model,path:this._oMetaData.path,type:this._oTypes.getType(this._oMetaData.property)};}this._addObjectStatusAttributes(n);var Z=new p(this._oParent.getId()+"-objStatus",n);return{control:Z,onCreate:"_onCreate",params:{getValue:"getText",noValidation:true}};};W.prototype._addObjectStatusAttributes=function(n){var X,Y=this._oParent.getControlProposal(),Z=Y.getObjectStatus();if(Z){X=Z.getBindingInfo("criticality");}var $=function(a1){var b1={0:V.None,1:V.Error,2:V.Warning,3:V.Success};var c1={"com.sap.vocabularies.UI.v1.CriticalityType/Neutral":V.Neutral,"com.sap.vocabularies.UI.v1.CriticalityType/Negative":V.Warning,"com.sap.vocabularies.UI.v1.CriticalityType/Critical":V.Error,"com.sap.vocabularies.UI.v1.CriticalityType/Positive":V.Success};return c1[a1]||b1[a1]||V.None;};var _=function(){var a1,b1={"Error":"sap-icon://status-negative","Warning":"sap-icon://status-critical","Success":"sap-icon://status-positive","None":"sap-icon://status-inactive"};if(X){if(X.formatter){a1=X.formatter.apply(null,arguments);}else{a1=arguments[0];}}else{a1=Z.getCriticality();}if((a1===undefined)||(a1===null)){return null;}return b1[$(a1)];};if(X){n.state={formatter:function(){var a1;if(X.formatter){a1=X.formatter.apply(null,arguments);}else{a1=arguments[0];}return $(a1);},parts:X.parts};if(Z.getCriticalityRepresentationType()!==G.WithoutIcon){n.icon={formatter:_,parts:X.parts};}}else{if(Z){n.state=$(Z.getCriticality());if(Z.getCriticalityRepresentationType()!==G.WithoutIcon){n.icon=_();}}else{n.icon=_();}}};W.prototype._createEdmString=function(){if(this._oSelector.checkCheckBox()){return this._createCheckBox();}var n=this._oSelector.checkSelection();if(n.selection){return this._createSelect({valueHelp:W.getValueHelpDropdownSettings(n)});}n=this._oSelector.checkComboBox();if(n.combobox){return this._createComboBox({valueHelp:W.getValueHelpDropdownSettings(n),edit:true});}var X={width:true,textAlign:true,placeholder:true,tooltip:true,name:true,valueState:true,valueStateText:true};var Y=this.getEdmProperty();if(this._oHelper.oAnnotation.isMultiLineText(Y)){delete X["width"];return this._createMultiLineText({attributesNamesMap:X});}var Z=this._oParent.isTextInEditModeSourceNotNone(),$=/Edm.String|Edm.Guid/.test(Y.type);if(Z){w($,"The ValueList and NavigationProperty"+"members of the sap.ui.comp.smartfield.TextInEditModeSource enumeration are only supported for OData "+"EDM Properties typed as Edm.String or Edm.Guid. - "+this.getMetadata().getName());}var _=W.getBoundPropertiesMapInfoForControl(I.getMetadata().getName(),{propertyName:"value"})[0];var a1=this._oParent.getTextInEditModeSource(),b1;this.oTextArrangementDelegate.bValidMetadata=$&&this.oTextArrangementDelegate.checkRequiredMetadata(a1);if(this.oTextArrangementDelegate.bValidMetadata){b1=this.createAttributes("",this._oMetaData.property,X);b1[_]=this.oTextArrangementDelegate.getBindingInfo();}else{b1=this.createAttributes(_,this._oMetaData.property,X);}var c1=new I(this._oParent.getId()+"-input",b1);if(this._oHelper.oAnnotation.isMasked(Y)){c1.setType(A.Password);}var d1=this.getCustomDataConfiguration();this._handleEventingForEdmString({control:c1,edmProperty:this._oMetaData.property.property,currency:d1&&d1.currency});if(d1&&(typeof d1.onInput==="function")){d1.onInput(c1);}return{control:c1,onCreate:"_onCreate",params:{valuehelp:{annotation:n.annotation,noDialog:!this._oParent.getShowValueHelp(),noTypeAhead:!this._oParent.getShowSuggestion(),aggregation:"suggestionRows"},getValue:"getValue",type:{type:b1.value.type,property:this._oMetaData.property}}};};W.getValueHelpDropdownSettings=function(n){return{annotation:n.annotation,noDialog:true,noTypeAhead:true};};W.prototype._getMaxLength=function(){return this._oTypes.getMaxLength(this._oMetaData.property,this._oParent.getBindingInfo("value"));};W.prototype._addAriaLabelledBy=function(n){var X,Y,Z;if((this._oParent.getControlContext()===J.None)||(this._oParent.getControlContext()===J.Form)||(this._oParent.getControlContext()===J.SmartFormGrid)){f.prototype._addAriaLabelledBy.apply(this,arguments);Z=this._oParent.data("configdata");if(Z&&Z.configdata.isInnerControl&&Z.configdata.isUOM){if(n){Y=n.control;if(Y instanceof H){if(Y.getItems().length>0){Y=Y.getItems()[0];}}}if(Y&&Y.getAriaLabelledBy&&Y.getAriaLabelledBy().length===0){var $=this.getEdmProperty();if(this._oHelper.oAnnotation.getLabel($)){X=new u({text:this._oHelper.oAnnotation.getLabel($)});Y.addAriaLabelledBy(X);this._oParent.addAggregation("_ariaLabelInvisibleText",X);}}}}};W.prototype._handleEventingForEdmString=function(n){var X=n.control;if(!X){return;}var Y=this._oHelper.oAnnotation.isUpperCase(n.edmProperty);X.attachChange(function onCurrencyInputFieldChange(Z){var $={},_=Z&&Z.getParameters();if(_){var a1=_.value;if(Y&&a1){a1=a1.toUpperCase();X.setValue(a1);}$.value=a1;$.newValue=a1;if(_.validated){$.validated=_.validated;}if(X._oSuggestionPopup&&X._oSuggestionPopup.isOpen()){if(!_.validated){if(X._iPopupListSelectedIndex>=0){return;}}}if(n.currency){var b1=this.getCurrencyValidationSettings();this.updateModelPropertiesForCurrency("value",b1);}else{try{this._oParent.fireChange($);}catch(c1){v.error(c1);}}}}.bind(this));};W.prototype.getUOMChangeHandler=function(n){return function(X){try{var Y=n.smartFieldRootControl,Z=X.getParameters(),$=Z.value;if(n.currency){var _=this.getCurrencyValidationSettings(n);this.updateModelPropertiesForCurrency("value",_);}Y.fireChange({value:$,newValue:$,unitChanged:!!n.unit,validated:!!Z.validated});}catch(a1){v.error(a1);}}.bind(this);};W.prototype.getCurrencyValidationSettings=function(n){var X;if(n){X=n.smartFieldRootControl;}else{var Y=this.getCustomDataConfiguration();X=Y&&Y.smartFieldRootControl;}var Z=X.getInnerControls();return{amountField:Z[0],currencyField:Z[1],errorState:X._oError,checkValidity:X.checkValuesValidity.bind(X)};};W.prototype.updateModelPropertiesForCurrency=function(n,X){var Y=X.amountField,Z=X.currencyField,$=Y.getValue(),_=Z.getMetadata().getName();var a1=W.getBoundPropertiesMapInfoForControl(_,{propertyName:n})[0];var b1="get"+y(a1),c1=Z[b1](),d1=[$,c1];var e1={rawValues:d1,handleSuccess:false};var f1=X.checkValidity(e1);function g1(j1){var k1=Y.getModel(),l1=Y.getBindingContext(),m1=Y.getBinding(n),n1=Z.getBinding(a1),o1=m1.getType(),p1=n1.getType(),q1=m1.getExternalValue(),r1=n1.getExternalValue(),s1=o1.parseValue($,"string",d1),t1=s1[0],u1=s1[1],v1=o1.formatValue(s1,"string"),w1=p1.formatValue(u1,"string"),x1=Y.getBindingPath(n),y1=Z.getBindingPath(a1);if(k1.getDefaultBindingMode()===B.TwoWay){if(!j1){k1.setProperty(x1,t1,l1);}k1.setProperty(y1,u1,l1);}if(!j1){Y.setValue(v1);}var z1=false,A1=true;if(m1.hasValidation()&&!j1){var B1={element:Y,property:n,type:o1,newValue:v1,oldValue:q1};Y.fireValidationSuccess(B1,z1,A1);}if(n1.hasValidation()){var C1={element:Z,property:a1,type:p1,newValue:w1,oldValue:r1};Z.fireValidationSuccess(C1,z1,A1);}}function h1(j1){}function i1(){var j1=X.errorState;if(j1.bComplex&&j1.bFirst&&j1.bSecond){var k1=Y.getBinding(n).getExternalValue();d1=[k1,c1];var e1={rawValues:d1,innerControls:[Z],handleSuccess:false};var f1=X.checkValidity(e1);f1.then(g1.bind(this,true)).catch(h1);}}f1.then(g1).catch(h1).finally(i1);};W.prototype._createComboBox=function(n){var X=null,Y=this._oParent.data("configdata"),Z={width:true,textAlign:true,placeholder:true,tooltip:true,name:true,valueState:true};var $=W.getBoundPropertiesMapInfoForControl(a.getMetadata().getName(),{propertyName:"value"})[0];var _={change:function(a1){if(a1.getParameter("itemPressed")){return;}var b1=a1.getSource().getSelectedKey();this._oParent.fireChange({value:b1,newValue:b1});}.bind(this),selectionChange:this._oHelper.getSelectionChangeHandler(this._oParent)};_=Object.assign(_,this.createAttributes($,this._oMetaData.property,Z));if(_.width===""){_.width="100%";}if(n.edit){X=new a(this._oParent.getId()+"-comboBoxEdit",_);}else{X=this._createDisplayedComboBox(_);}if(Y&&Y.configdata&&Y.configdata.onText){Y.configdata.onText(X);}return{control:X,onCreate:"_onCreate",params:{valuehelp:{annotation:n.valueHelp.annotation,aggregation:"items",noDialog:n.valueHelp.noDialog,noTypeAhead:n.valueHelp.noTypeAhead},getValue:"getSelectedKey",type:{type:_.selectedKey.type,property:this._oMetaData.property}}};};W.prototype._createDisplayedComboBox=function(n){var X=a.extend("sap.ui.comp.smartfield.DisplayComboBox",{metadata:{library:"sap.ui.comp",properties:{wrapping:{type:"boolean",group:"Appearance",defaultValue:true}}},renderer:function(Y,Z){var $=Z.getWidth(),_=Z.getValue(),a1=Z.getTextDirection(),b1=Z.getTextAlign(),c1=Z.getTooltip_AsString(),d1=Z.getWrapping();Y.write("<span");Y.writeControlData(Z);Y.addClass("sapMText");Y.addClass("sapUiSelectable");if(d1){if(_&&(_.length>0)&&!/\s/.test(_)){Y.addClass("sapMTextBreakWord");}}else{Y.addClass("sapMTextNoWrap");}if($){Y.addStyle("width",$);}else{Y.addClass("sapMTextMaxWidth");}if(a1!==K.Inherit){Y.writeAttribute("dir",a1.toLowerCase());}if(c1){Y.writeAttributeEscaped("title",c1);}if(b1){b1=R.getTextAlign(b1,a1);if(b1){Y.addStyle("text-align",b1);}}var e1=d1?"sapMTextRenderWhitespaceWrap":"sapMTextRenderWhitespace";Y.addClass(e1);Y.writeClasses();Y.writeStyles();Y.write(">");_.replace(/\r\n|\n\r|\r/g,"\n");Y.writeEscaped(_);Y.write("</span>");},updateDomValue:function(Y){if(!this.isActive()){return this;}Y=this._getInputValue(Y);if(this.$().text()!==Y){this.$().text(Y);this._bCheckDomValue=true;}return this;},getValue:function(){return this.getProperty("value");},getFocusDomRef:function(){return this.getDomRef();},getEditable:function(){return false;}});return new X(this._oParent.getId()+"-comboBoxDisp",n);};W.prototype._createSelect=function(n){var X={width:true,name:true,valueState:true};var Y=W.getBoundPropertiesMapInfoForControl(S.getMetadata().getName(),{propertyName:"value"})[0];var Z={change:this._oHelper.getSelectionChangeHandler(this._oParent),forceSelection:false};Z=Object.assign(Z,this.createAttributes(Y,this._oMetaData.property,X));if(Z.width===""){Z.width="100%";}return{control:new S(this._oParent.getId()+"-select",Z),onCreate:"_onCreate",params:{valuehelp:{annotation:n.valueHelp.annotation,aggregation:"items",noDialog:n.valueHelp.noDialog,noTypeAhead:n.valueHelp.noTypeAhead},getValue:"getSelectedKey",type:{type:Z.selectedKey.type,property:this._oMetaData.property}}};};W.prototype._createCheckBox=function(){var n=W.getBoundPropertiesMapInfoForControl(C.getMetadata().getName(),{propertyName:"value"})[0];var X=this.createAttributes(n,null,{},{event:"select",parameter:"selected"});X.editable=(this._oParent.getEditable()&&this._oParent.getEnabled()&&this._oParent.getContextEditable());X.selected.type=this._oTypes.getAbapBoolean();return{control:new C(this._oParent.getId()+"-cBox",X),onCreate:"_onCreate",params:{getValue:"getSelected"}};};W.prototype._createEdmDateTime=function(){var n=this.getFormatSettings("dateFormatSettings"),X;var Y={width:true,textAlign:true,placeholder:true,name:true,valueState:true};var Z=this.createAttributes(null,this._oMetaData.property,Y,{event:"change",parameter:"value"});if(this._oSelector.checkDatePicker()){X=W.getBoundPropertiesMapInfoForControl(D.getMetadata().getName(),{propertyName:"value"})[0];Z[X]={path:this._oMetaData.path,type:this._oTypes.getType(this._oMetaData.property,n,{displayFormat:"Date"}),model:this._oMetaData.model,mode:this._oParent.getBindingMode("value")};if(n&&n.style){Z.displayFormat=n.style;}return{control:new D(this._oParent.getId()+"-datePicker",Z),onCreate:"_onCreate",params:{getValue:"getValue",type:{type:Z.value.type,property:this._oMetaData.property}}};}X=W.getBoundPropertiesMapInfoForControl(b.getMetadata().getName(),{propertyName:"value"})[0];Z[X]={path:this._oMetaData.path,model:this._oMetaData.model,type:this._oTypes.getType(this._oMetaData.property,n),mode:this._oParent.getBindingMode("value")};return{control:new b(this._oParent.getId()+"-input",Z),onCreate:"_onCreate",params:{getValue:"getValue",type:{type:Z.value.type,property:this._oMetaData.property}}};};W.prototype._createEdmDateTimeOffset=function(){var n=this.getFormatSettings("dateFormatSettings");if(n){n.UTC=false;}var X=W.getBoundPropertiesMapInfoForControl(b.getMetadata().getName(),{propertyName:"value"})[0];var Y={width:true,textAlign:true,placeholder:true,name:true,valueState:true};var Z=this.createAttributes(null,this._oMetaData.property,Y,{event:"change",parameter:"value"});Z[X]={model:this._oMetaData.model,path:this._oMetaData.path,type:this._oTypes.getType(this._oMetaData.property,n),mode:this._oParent.getBindingMode("value")};return{control:new b(this._oParent.getId()+"-input",Z),onCreate:"_onCreate",params:{getValue:"getValue",type:{type:Z.value.type,property:this._oMetaData.property}}};};W.prototype._createEdmNumeric=function(){var n=this._oSelector.checkComboBox();if(n.combobox){return this._createComboBox({valueHelp:{annotation:n.annotation,noDialog:true,noTypeAhead:true},edit:true});}var X={width:true,textAlign:true,placeholder:true,name:true,valueState:true};var Y=W.getBoundPropertiesMapInfoForControl(I.getMetadata().getName(),{propertyName:"value"})[0];var Z=this.createAttributes(Y,this._oMetaData.property,X,{event:"change",parameter:"value"});if(this._oParent.isContextTable()&&sap.ui.getCore().getConfiguration().getRTL()){Z.textDirection="LTR";}return{control:new I(this._oParent.getId()+"-input",Z),onCreate:"_onCreate",params:{getValue:"getValue",type:{type:Z.value.type,property:this._oMetaData.property}}};};W.prototype._createEdmUOM=function(){var n=this.getEdmProperty(),X=this._oMetaData.annotations.uom.property.property,Y=this._oMetaData.annotations.uom&&this._oHelper.oAnnotation.isCurrency(n,X);var Z={currency:Y,edmProperty:X};var $=this._createEdmUOMAttributes(Z),_=sap.ui.getCore().getConfiguration().getRTL(),a1=_&&this._oParent.isContextTable(),b1=this._oParent.getId(),c1;if(a1){$.textDirection="LTR";}var d1=new I(b1+"-input",$);this.oMeasureField=d1;if(this._oParent.data("suppressUnit")==="true"){var e1={getValue:"getValue"};if(!Y){e1.type={type:$.value.type,property:this._oMetaData.property};}return{control:d1,onCreate:"_onCreate",params:e1};}if(!Y){c1={type:$.value.type,property:this._oMetaData.property};}var f1={change:this.getUOMChangeHandler({smartFieldRootControl:this._oParent,unit:true}),textAlign:this._getEdmUOMTextAlignment()};var g1=W.getBoundPropertiesMapInfoForControl(Q.getMetadata().getName(),{propertyName:"value"})[0];var h1=this._oHelper.getUOMPath(this._oMetaData);f1[g1]={model:this._oMetaData.model,path:h1};this.mapBindings(f1,W._getEmbeddedSmartFieldMapSettings());if(this._oParent.getConfiguration()){f1.configuration=new t({preventInitialDataFetchInValueHelpDialog:this._getPreventInitialDataFetchInVHDialog()});}var i1=new Q(b1+"-sfEdit",f1),j1=this;i1.data("configdata",{"configdata":{currency:Y,smartFieldRootControl:this._oParent,measureField:this.oMeasureField,isInnerControl:true,isUOM:!this._oParent.data("configdata"),model:this._oMetaData.model,navigationPath:this._oMetaData.annotations.uom.navigationPath||null,path:h1,entitySetObject:this._oMetaData.annotations.uom.entitySet,entityType:this._oMetaData.annotations.uom.entityType,property:this._oMetaData.annotations.uom.property,annotations:{valuelist:this._oMetaData.annotations.valuelistuom,valuelistType:this._oMetaData.annotations.uom.annotations.valuelistType,text:this._oMetaData.annotations.textuom},modelObject:this._oMetaData.modelObject||this._oModel,onText:function(l1){d1.setLayoutData(new F({growFactor:1}));i1.setLayoutData(j1._getStaticUOMTextFlexItemData({shrinkFactor:0,styleClass:"sapUiCompSmartFieldFlexItemUnitDisplay"}));i1.addStyleClass("sapUiCompSmartFieldUOMDisplayText");if(l1){if(a1&&(typeof l1.setTextDirection==="function")){l1.setTextDirection("LTR");}l1.addStyleClass("sapUiCompSmartFieldUnit");}},onInput:function(l1){d1.setLayoutData(j1._getDynamicAmountInputFlexItemData({control:i1}));i1.setLayoutData(j1._getStaticUOMInputFlexItemData({growFactor:0,styleClass:"sapUiCompSmartFieldFlexItemUnitEdit",minWidth:""}));if(l1){if(a1&&(typeof l1.setTextDirection==="function")){l1.setTextDirection("LTR");}l1.addStyleClass("sapUiCompSmartFieldUnit");}}}});i1.data("errorCheck","setComplexClientErrorSecondOperandNested");d1.addAriaLabelledBy(i1);if(i1.getVisible()){d1.addStyleClass("smartFieldPaddingRight");}d1.addStyleClass("sapUiCompSmartFieldValue");var k1=new H({justifyContent:E.End,items:[d1,i1],fitContainer:true,width:this._oParent.getWidth()});k1.addStyleClass("sapUiCompUOM");k1.enhanceAccessibilityState=function(l1,m1){this._oParent.enhanceAccessibilityState(l1,m1);}.bind(this);if(this._oParent.isContextTable()){if(a1){k1.addStyleClass("sapUiCompDirectionLTR");}k1.addStyleClass("sapUiCompUOMInTable");if(this._oParent.getMode()!=="edit"){k1.addStyleClass("sapUiCompUOMInTableDisplay");}}return{control:k1,onCreate:"_onCreateUOM",params:{getValue:true,valuehelp:true,type:c1}};};W.prototype._createEdmUOMAttributes=function(n){n=n||{};var X=this.createUOMDefaultAttributes(n);var Y=W.getBoundPropertiesMapInfoForControl(I.getMetadata().getName(),{propertyName:"value"})[0];var Z=n.currency||(this._oMetaData.annotations.uom&&this._oHelper.oAnnotation.isCurrency(this.getEdmProperty(),this._oMetaData.annotations.uom.property.property));if(Z){X[Y]={parts:[{path:this._oMetaData.path},{path:this._oHelper.getUOMPath(this._oMetaData)}],model:this._oMetaData.model,mode:B.OneWay,type:this._oTypes.getCurrencyType(this._oMetaData.property)};}else{X[Y]={model:this._oMetaData.model,path:this._oMetaData.path,type:this._oTypes.getType(this._oMetaData.property)};}return X;};W.prototype.createUOMDefaultAttributes=function(n){return{textAlign:this._getEdmUOMTextAlignment(),placeholder:this.getAttribute("placeholder"),name:this.getAttribute("name"),change:this.getUOMChangeHandler({smartFieldRootControl:this._oParent,currency:n.currency}),valueState:this.getValueStateBindingInfoForRecommendationStateAnnotation()};};W.prototype._getEdmUOMTextAlignment=function(){var n=this.getAttribute("textAlign");if(!n){n=z.Initial;}if(n===z.Initial){if(this._oParent.isContextTable()){return z.End;}return z.Begin;}return n;};W.prototype._createEdmUOMDisplay=function(){var n=this,X=this._oHelper.getUOMPath(this._oMetaData),Y=this._getEdmUOMTextAlignment(),Z=null,$=this.getEdmProperty(),_=sap.ui.getCore().getConfiguration().getRTL(),a1=_&&this._oParent.isContextTable();var b1=W.getBoundPropertiesMapInfoForControl(d.getMetadata().getName(),{propertyName:"value"})[0];var c1={textAlign:Y};c1[b1]={parts:[{path:this._oMetaData.path,type:this._oTypes.getType(this._oMetaData.property)},{path:X}],model:this._oMetaData.model,formatter:this._oTypes.getDisplayFormatter($,{currency:this._oHelper.oAnnotation.isCurrency($),mask:this._oHelper.oAnnotation.isMasked($)}),useRawValues:true};if(a1){c1.textDirection="LTR";}var d1=new d(this._oParent.getId()+"-text",c1);X=this._oHelper.getUOMPath(this._oMetaData);c1={change:this.getUOMChangeHandler({smartFieldRootControl:this._oParent,unit:true}),textAlign:this._getEdmUOMTextAlignment()};b1=W.getBoundPropertiesMapInfoForControl(Q.getMetadata().getName(),{propertyName:"value"})[0];c1[b1]={model:this._oMetaData.model,path:X};this.mapBindings(c1,W._getEmbeddedSmartFieldMapSettings());d1.addStyleClass("smartFieldPaddingRight");d1.addStyleClass("sapUiCompSmartFieldValue");if(this._checkSuppressUnit()){return{control:d1};}Z=new Q(this._oParent.getId()+"-sfDisp",c1);Z.data("configdata",{"configdata":{isInnerControl:true,isUOM:!this._oParent.data("configdata"),model:this._oMetaData.model,navigationPath:this._oMetaData.annotations.uom.navigationPath||null,path:X,entitySetObject:this._oMetaData.annotations.uom.entitySet,entityType:this._oMetaData.annotations.uom.entityType,property:this._oMetaData.annotations.uom.property,annotations:{valuelist:this._oMetaData.annotations.valuelistuom,text:this._oMetaData.annotations.textuom},modelObject:this._oMetaData.modelObject||this._oModel,onText:function(f1){if(f1){if(f1.setWrapping){f1.setWrapping(false);}if(a1&&(typeof f1.setTextDirection==="function")){f1.setTextDirection("LTR");}f1.addStyleClass("sapUiCompSmartFieldUnit");}},onInput:function(f1){d1.setLayoutData(new F({growFactor:0}));Z.setLayoutData(new F({growFactor:0}));if(f1){if(a1&&(typeof f1.setTextDirection==="function")){f1.setTextDirection("LTR");}f1.addStyleClass("sapUiCompSmartFieldUnit");}},getContextEditable:function(){return n._oParent.getContextEditable();}}});Z.data("errorCheck","setComplexClientErrorSecondOperandNested");var e1=new H({alignItems:P.Center,items:[d1,Z],fitContainer:true,width:this._oParent.getWidth()});e1.enhanceAccessibilityState=function(f1,g1){this._oParent.enhanceAccessibilityState(f1,g1);}.bind(this);if(this._oParent.isContextTable()){e1.setJustifyContent("End");this._oParent.addStyleClass("sapUiCompUOMInTable");if(a1){e1.addStyleClass("sapUiCompDirectionLTR");}e1.addStyleClass("sapUiCompUOMInTable");}return{control:e1};};W.prototype._createEdmUOMObjectStatus=function(){var n,X=this.getEdmProperty(),Y=this._oTypes.getDisplayFormatter(X,{currency:this._oHelper.oAnnotation.isCurrency(X)}),Z=this._oHelper.getUOMPath(this._oMetaData),$={};var _=W.getBoundPropertiesMapInfoForControl(p.getMetadata().getName(),{propertyName:"value"})[0];$[_]={parts:[{path:this._oMetaData.path,type:this._oTypes.getType(this._oMetaData.property)},{path:Z}],formatter:function(){var a1=Y.apply(this,arguments);return a1+arguments[1];},useRawValues:true};this._addObjectStatusAttributes($);n=new p(this._oParent.getId()+"-objStatus",$);n.addStyleClass("sapUiCompUOM");return{control:n};};W.prototype._createEdmUOMObjectNumber=function(){var n,X,Y=this._getEdmUOMTextAlignment();var Z=W.getBoundPropertiesMapInfoForControl(k.getMetadata().getName(),{propertyName:"value"});if(this._oMetaData.annotations.uom&&this._oHelper.oAnnotation.isCurrency(this.getEdmProperty(),this._oMetaData.annotations.uom.property.property)){n={model:this._oMetaData.model,textAlign:Y};n[Z[0]]={parts:[{path:this._oMetaData.path},{path:this._oHelper.getUOMPath(this._oMetaData)}],type:this._oTypes.getCurrencyType(this._oMetaData.property)};n[Z[1]]={path:this._oHelper.getUOMPath(this._oMetaData)};}else{n={model:this._oMetaData.model,textAlign:Y};n[Z[0]]={path:this._oMetaData.path,type:this._oTypes.getType(this._oMetaData.property)};n[Z[1]]={path:this._oHelper.getUOMPath(this._oMetaData)};}X=new k(this._oParent.getId()+"-objNumber",n);X.addStyleClass("sapUiCompUOM");return{control:X};};W.prototype._createEdmSemantic=function(){var n=this,X=this._oParent.getBindingPath("value"),Y=this.getEdmProperty(),Z=this._oHelper.oAnnotation.getLabel(Y);if(this._oMetaData.annotations.lineitem&&this._oMetaData.annotations.lineitem.labels&&this._oMetaData.annotations.lineitem.labels[X]){Z=this._oMetaData.annotations.lineitem.labels[X];}var $={semanticObject:this._oMetaData.annotations.semantic.defaultSemanticObject,additionalSemanticObjects:this._oMetaData.annotations.semantic.additionalSemanticObjects,semanticObjectLabel:Z,fieldName:X,width:this.getAttribute("width"),createControlCallback:function(){var b1=this.createControl(true);if(b1){return b1.control;}return null;}.bind(this)};var _=this._oHelper.oAnnotation.getText(Y);this.oType=this._oTypes.getType(this._oMetaData.property);if(_){$.text={parts:[this._oMetaData.path,this._oHelper.getEdmDisplayPath(this._oMetaData)],model:this._oMetaData.model,formatter:function(b1,c1){if(n.oType){b1=n.oType.formatValue(b1,"string");}if(b1&&c1){return n._formatDisplayBehaviour("defaultInputFieldDisplayBehaviour",b1,c1);}return b1?b1:"";}};$.navigationTargetsObtained=function(b1){var c1=this.getBinding("text");if(!Array.isArray(c1.getValue())){b1.getParameters().show();return;}var d1=c1.getValue();var e1=n._getDisplayBehaviourConfiguration("defaultInputFieldDisplayBehaviour")||"idOnly";var f1=s.getTextsFromDisplayBehaviour(e1,d1[0],d1[1]);var g1=b1.getParameters().mainNavigation;if(g1){g1.setDescription(f1.secondText);}b1.getParameters().show(f1.firstText,g1,undefined,undefined);};}else{var a1=this._oHelper.getUOMPath(this._oMetaData);if(a1){$.text={parts:[{path:X},{path:a1}],model:this._oMetaData.model,formatter:this._oHelper.oAnnotation.isCurrency(Y,this._oMetaData.annotations.uom.property.property)?s.getAmountCurrencyFormatter():s.getMeasureUnitFormatter(),useRawValues:true};$.uom={path:a1};}else{$.text={path:X,model:this._oMetaData.model,type:this.oType};}}return{control:new e(this._oParent.getId()+"-sl",$),onCreate:"_onCreate",params:{getValue:"getInnerControlValue"}};};W.prototype._createMultiLineText=function(n){var X=W.getBoundPropertiesMapInfoForControl(T.getMetadata().getName(),{propertyName:"value"})[0];var Y=this.createAttributes(X,this._oMetaData.property,n.attributesNamesMap);var Z=this.getFormatSettings("multiLineSettings");Y=x(Y,Z);if(this._oParent.isContextTable()){Y.width="100%";}var $=new T(this._oParent.getId()+"-textArea",Y);this._handleEventingForEdmString({control:$,edmProperty:this._oMetaData.property.property});return{control:$,onCreate:"_onCreate",params:{type:{type:Y.value.type,property:this._oMetaData.property},getValue:"getValue"}};};W.prototype._createLink=function(){var n=this,X=this._oParent,Y=X.getBindingInfo("url");var Z={text:"",href:""};var $=W.getBoundPropertiesMapInfoForControl(L.getMetadata().getName(),{propertyName:"url"})[0];if(Y){Z[$]=this._oBinding.toBinding(Y);}else{Z[$]=X.getUrl();}if(X.hasListeners("press")){Z.press=function(f1){f1.preventDefault();X.firePress(f1);};}var _=X.getBindingInfo("value");var a1=W.getBoundPropertiesMapInfoForControl(L.getMetadata().getName(),{propertyName:"value"});if(_){var b1=this._oMetaData,c1=b1.path,d1=b1.property.property;if(b1.annotations.text&&(d1.type==="Edm.String")){Z[a1[0]]={parts:[b1.path,this._oHelper.getEdmDisplayPath(b1)],formatter:this._formatText.bind(n)};}else if(W.isSpecialLink(d1)){var e1=W[W._getLinkFormatterFunctionName(d1)];Z[a1[0]]={path:c1};Z[a1[1]]={path:c1,formatter:null};if(typeof e1==="function"){Z[a1[1]].formatter=e1;}}else{Z[a1[0]]=this._oBinding.toBinding(_);}}else{Z[a1[0]]=X.getValue();}return{control:new L(X.getId()+"-link",Z),onCreate:"_onCreate",params:{noValidation:true}};};W.prototype._createEdmBoolean=function(){var n=this._oSelector.checkComboBox(),X=this._oParent.getEditable()&&this._oParent.getEnabled()&&this._oParent.getContextEditable(),Y=this,Z=null,$;if(n.combobox){if(X||this._oParent.getFetchValueListReadOnly()){return this._createComboBox({valueHelp:{annotation:n.annotation,noDialog:true,noTypeAhead:true},edit:X});}}var _,a1;if(X){a1=W.getBoundPropertiesMapInfoForControl(C.getMetadata().getName(),{propertyName:"value"})[0];_=this.createAttributes(a1,this._oMetaData.property,{},{event:"select",parameter:"selected"});$=new C(this._oParent.getId()+"-cBoxBool",_);Z={getValue:"getSelected"};}else{a1=W.getBoundPropertiesMapInfoForControl(d.getMetadata().getName(),{propertyName:"value"})[0];_=this.createAttributes(a1,this._oMetaData.property,{width:true,textAlign:true});_[a1]={model:this._oMetaData.model,path:this._oMetaData.path,formatter:function(b1){return Y._formatDisplayBehaviour("defaultCheckBoxDisplayBehaviour",b1);}};$=new d(this._oParent.getId()+"-text",_);}return{control:$,onCreate:"_onCreate",params:Z};};W.prototype._createValueHelp=function(){var n=this._oParent.getContent();if(!n){return;}var X={annotation:this._oMetaData.annotations.valuelist,noDialog:!this._oParent.getShowValueHelp(),noTypeAhead:!this._oParent.getShowSuggestion(),aggregation:"suggestionRows"};this._getValueHelpDialogTitle(X);X.analyser=this._oHelper.getAnalyzer(this._oModel||this._oMetaData.modelObject);this.createValueHelp({control:n,edmProperty:this.getEdmProperty(),valueHelp:X,model:this._oModel||this._oMetaData.modelObject,onValueListChange:function(Y){this._oParent.fireValueListChanged({changes:Y.mParameters.changes});}.bind(this)});};W.prototype._checkSuppressUnit=function(){if(this._oParent.data("suppressUnit")==="true"){return true;}var n=this._oParent.getBindingInfo("uomVisible");return(!n&&!this._oParent.getUomVisible());};W.prototype.getEdmProperty=function(){var n=this._oHelper;if(n){return n.getEdmProperty(this._oMetaData);}return null;};W.prototype.getEntityType=function(){if(this._oMetaData){return this._oMetaData.entityType;}return null;};W.prototype._checkLink=function(){var n=this._oParent.getBindingInfo("url"),X=this.getEdmProperty();if(n||this._oParent.getUrl()||W.isSpecialLink(X)){return true;}return this._oParent.hasListeners("press");};W._getEmbeddedSmartFieldMapSettings=function(){return{"uomEditable":"editable","uomEnabled":"enabled","uomVisible":"visible","mandatory":"mandatory"};};W.getBoundPropertiesMapInfoForControl=function(n,X){X=X||{};var Y=null;switch(n){case"sap.m.Input":case"sap.m.TimePicker":case"sap.m.DatePicker":case"sap.m.DateTimePicker":case"sap.m.TextArea":Y={value:["value"]};break;case"sap.m.Text":case"sap.m.ObjectIdentifier":case"sap.ui.comp.navpopover.SmartLink":Y={value:["text"]};break;case"sap.m.Link":Y={url:["href"],value:["text","href"]};break;case"sap.m.ObjectStatus":Y={value:["text","state","icon"]};break;case"sap.m.ObjectNumber":Y={value:["number","unit"]};break;case"sap.m.Select":case"sap.m.ComboBox":case"sap.ui.comp.smartfield.DisplayComboBox":Y={value:["selectedKey"]};break;case"sap.m.CheckBox":Y={value:["selected"]};break;case"sap.ui.comp.smartfield.SmartField":var Z=Object.keys(Q.getMetadata().getProperties());Y={};Z.forEach(function($,_,a1){Y[$]=[a1[_]];});break;}if(Y&&X.propertyName){return Y[X.propertyName]||null;}return Y;};W.isSpecialLink=function(n){return M.isEmailAddress(n)||M.isPhoneNumber(n)||M.isURL(n);};W._getLinkFormatterFunctionName=function(n){return"_format"+M.getLinkDisplayFormat(n);};W._formatEmailAddress=function(n){return"mailto:"+n;};W._formatPhoneNumber=function(n){return"tel:"+n;};W._formatURL=function(n){return U.validate(n)?n:"";};W.prototype._formatText=function(n,X){if(n&&X){return this._formatDisplayBehaviour("defaultInputFieldDisplayBehaviour",n,X);}return n||"";};W.prototype._getCreator=function(n){return this._oSelector.getCreator(n);};W.prototype._onCreate=function(n,X){var Y,Z,$=true,_=this;if(X){if(X.noValidation){$=false;}if(X.valuehelp&&this.shouldCreateValueHelpForControl(n)){this._getValueHelpDialogTitle(X.valuehelp);X.valuehelp.analyser=this._oHelper.getAnalyzer(this._oModel||this._oMetaData.modelObject);this.createValueHelp({control:n,edmProperty:this.getEdmProperty(),valueHelp:X.valuehelp,model:this._oModel||this._oMetaData.modelObject,onValueListChange:function(a1){_._oParent.fireValueListChanged({changes:a1.mParameters.changes});}});}if(X.getValue){Y=X.getValue;X.getValue=function(){return n[Y]();};}if(X.type){Z=this._oFieldControl.getMandatoryCheck(X.type.property);if(Z){X.type.type.oFieldControl=Z;}}}if($){this.addValidations(n,this._oParent.data("errorCheck")||"setSimpleClientError");}if(!this._checkUOM()){n.addStyleClass("sapUiCompSmartFieldValue");}};W.prototype._checkUOM=function(){var n=this._oParent.data("configdata");if(n&&n.configdata){if(n.configdata.onInput||n.configdata.onText){return true;}}return false;};W.prototype.getValueStateBindingInfoForRecommendationStateAnnotation=function(n,X,Y){n=n||this.getEdmProperty();var Z=n&&n["com.sap.vocabularies.UI.v1.RecommendationState"];if(!Z){return null;}w(!(Z.Path===undefined),'Missing "Path" attribute of the "com.sap.vocabularies.UI.v1.RecommendationState" annotation for "'+n.name+'" EDM property of "'+this._oMetaData.entityType.name+'" entity type. - '+this.getMetadata().getName());w(!(Z.Path===""),'Missing path name of "com.sap.vocabularies.UI.v1.RecommendationState" annotation for "'+n.name+'" EDM property of "'+this._oMetaData.entityType.name+'" entity type. - '+this.getMetadata().getName());X=X||this._oHelper.findProperty(this._oMetaData.entityType.property,Z.Path);w(!!X,'The EDM property was not found in the "'+this._oMetaData.entityType.name+'" entity type. - '+this.getMetadata().getName());if(X&&(X.type==="Edm.Byte")){return{model:Y||this._oMetaData.model,path:Z.Path,formatter:W.formatRecommendationState};}w(X&&(X.type==="Edm.Byte"),'The EDM property "'+X.name+'" of "'+this._oMetaData.entityType.name+'" entity type must be typed as Edm.Byte. - '+this.getMetadata().getName());return null;};W.formatRecommendationState=function(n){n=String(n);switch(n){case"0":return V.None;case"1":return V.Information;case"2":return V.Warning;default:return V.None;}};W.prototype._getDynamicAmountInputFlexItemData=function(n){var X="sapUiCompSmartFieldFlexItemAmountEdit",Y="",Z=n.control;if(Z&&!Z.getVisible()){X="sapUiCompSmartFieldFlexItemAmountNoUnitEdit";Y="100%";}var $=this._oAmountInputFlexItemData;if($&&!$.bIsDestroyed){$.setMaxWidth(Y);$.setStyleClass(X);return $;}this._oAmountInputFlexItemData=new F({growFactor:1,maxWidth:Y,styleClass:X});return this._oAmountInputFlexItemData;};W.prototype._getStaticUOMInputFlexItemData=function(n){var X=this._oUOMInputFlexItemData;if(X&&!X.bIsDestroyed){return X;}this._oUOMInputFlexItemData=new F(n);return this._oUOMInputFlexItemData;};W.prototype._getStaticUOMTextFlexItemData=function(n){var X=this._oUOMTextFlexItemData;if(X&&!X.bIsDestroyed){return X;}this._oUOMTextFlexItemData=new F(n);return this._oUOMTextFlexItemData;};W.prototype._getValueHelpDialogTitle=function(n){n.dialogtitle=this._oParent.getTextLabel();if(!n.dialogtitle){var X=this.getEdmProperty();n.dialogtitle=this._oHelper.oAnnotation.getLabel(X)||X.name;}};W.prototype._onCreateUOM=function(n,X){var Y=n.getItems(),Z;this.addValidations(Y[0],"setComplexClientErrorFirstOperand");if(X&&X.getValue){X.getValue=function(){return Y[0].getValue();};}X.uom=function(){return Y[1].getValue();};X.uomset=function($){Y[1].setValue($);};if(X.type){Z=this._oFieldControl.getMandatoryCheck(X.type.property);if(Z){X.type.type.oFieldControl=Z;}}};W.prototype.triggerCreationOfControls=function(n){try{if(n){this._init(n);}this._setUOMEditState();this._oFieldControl.bindProperties({metadata:this._oMetaData});this._oParent._toggleInnerControlIfRequired();this._addLabelAndQuickInfo();this._oParent.fireInitialise();}catch(X){v.error(X,null,this.getMetadata().getName());}};W.prototype.bind=function(){if(!(!this._bInitialized&&!this.bPending)){return Promise.resolve();}this._bInitialized=true;var n=this._oParent.data("configdata");if(n&&n.configdata){this.triggerCreationOfControls(this._oMeta);return Promise.resolve();}if(!this._oModel){return Promise.resolve();}var X=!!(this._oParent&&this._oParent.isTextInEditModeSourceNotNone());if(!X&&this._oModel.bMetaModelLoaded){this.triggerCreationOfControls(this._oMeta);return Promise.resolve();}this.bPending=true;var Y=this._oModel.getMetaModel().loaded();var Z=Y.then(function onMetaModelLoaded(){if(!this._oParent){this.bPending=false;return Promise.reject();}if(X){this._init(this._oMeta);var $=this._oMetaData.annotations.valuelist;if(typeof $==="string"){return this._oHelper.loadValueListAnnotation($);}else{this.bPending=false;this.triggerCreationOfControls();return Promise.reject();}}this.bPending=false;this.triggerCreationOfControls(this._oMeta);}.bind(this));Y.catch(function($){v.error("The meta model could not be loaded.",$,this.getMetadata().getName());}.bind(this));if(X){Z.then(function onValueListAnnotationLoaded($){if(!this._oParent){return;}this.bPending=false;if($){this._initValueList($);}this.triggerCreationOfControls();if($&&this.oTextArrangementDelegate){this.oTextArrangementDelegate.fetchIDAndDescriptionCollectionIfRequired();}}.bind(this));}Z.catch(function($){if($){v.error($,null,this.getMetadata().getName()+".onMetaModelLoaded");}}.bind(this));return Z;};W.prototype._addLabelAndQuickInfo=function(){var n=this.getDataProperty();n=n.property;var X=this._oHelper.oAnnotation.getLabel(n);var Y=this._oHelper.oAnnotation.getQuickInfo(n);if(X&&this._oParent.isPropertyInitial("textLabel")){this._oParent.setTextLabel(X);}if(Y&&this._oParent.isPropertyInitial("tooltipLabel")){this._oParent.setTooltipLabel(Y);}};W.prototype.rebindOnCreated=function(){var X,Y=this._oFieldControl.getControlFormatters(this._oMetaData,["editable"]);for(var n in Y){X=this._oBinding.fromFormatter(this._oMetaData.model,Y[n]);this._oParent.bindProperty(n,X);}};W.prototype._setUOMEditState=function(){if(this._oFieldControl.hasUomEditState(this._oMetaData)){var n=this._oFieldControl.getUOMEditState(this._oMetaData);if(n){var X=this._oBinding.fromFormatter(this._oMetaData.model,n);this._oParent.bindProperty("uomEditState",X);}}};W.prototype.getDataProperty=function(){return this._oMetaData.property;};W.prototype.getDropdownItemKeyType=function(n){var X=n.getMetadata().getName();if((X==="sap.ui.comp.smartfield.DisplayComboBox")||(X==="sap.m.ComboBox")||(X==="sap.m.Select")){var Y=W.getBoundPropertiesMapInfoForControl(X,{propertyName:"value"})[0];var Z=n.getBindingInfo(Y);return(Z&&Z.type)||null;}return null;};W.prototype.getMetaData=function(){return this._oMetaData;};W.prototype.getODataHelper=function(){return this._oHelper;};W.prototype.destroy=function(){if(this._oFieldControl){this._oFieldControl.destroy();}if(this._oSelector){this._oSelector.destroy();}if(this._oTypes){this._oTypes.destroy();}if(this._oHelper){this._oHelper.destroy();}if(this.oType){this.oType.destroy();this.oType=null;}if(this.oTextArrangementDelegate){this.oTextArrangementDelegate.destroy();}this._oHelper=null;this._oFieldControl=null;this._oTypes=null;this._oSelector=null;this._oMetaData=null;this._oAmountInputFlexItemData=null;this._oUOMInputFlexItemData=null;this._oUOMTextFlexItemData=null;this.oMeasureField=null;this.oTextArrangementDelegate=null;f.prototype.destroy.apply(this,arguments);};return W;},true);
