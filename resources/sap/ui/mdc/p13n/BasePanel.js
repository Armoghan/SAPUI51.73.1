/*
 * ! SAPUI5

		(c) Copyright 2009-2019 SAP SE. All rights reserved
	
 */
sap.ui.define(['sap/ui/core/Control','sap/m/Column','sap/m/Text','sap/ui/model/Filter',"sap/ui/core/Fragment"],function(C,a,T,F,b){"use strict";var B=C.extend("sap.ui.mdc.p13n.BasePanel",{library:"sap.ui.mdc",metadata:{library:"sap.ui.mdc",associations:{},defaultAggregation:"items",aggregations:{_content:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"},template:{type:"sap.ui.core.Control",multiple:false}},events:{change:{}}},init:function(){var f=b.createId(this.getId(),"BasePanelFragment");this._bShowSelected=false;this.oResourceBundle=sap.ui.getCore().getLibraryResourceBundle("sap.ui.mdc");b.load({name:"sap.ui.mdc.p13n.BasePanel",id:f,controller:this}).then(function(m){this._oMTable=m;this._oMTable.bPreventMassSelection=true;this.getModel().setProperty("/mode",this.oResourceBundle.getText("p13nDialog.REORDER"));if(this._aColTexts){this._addTableColumns(this._aColTexts);this._aColTexts=null;}if(this.getTemplate()){this._bindListItems();}this.setAggregation("_content",m);this._moveTopButton=b.byId(f,"IDButtonMoveToTop");this._moveTopButton.setTooltip(this.oResourceBundle.getText("p13nDialog.MOVE_TO_TOP"));this._moveUpButton=b.byId(f,"IDButtonMoveUp");this._moveUpButton.setTooltip(this.oResourceBundle.getText("p13nDialog.MOVE_UP"));this._moveDownButton=b.byId(f,"IDButtonMoveDown");this._moveDownButton.setTooltip(this.oResourceBundle.getText("p13nDialog.MOVE_DOWN"));this._moveBottomButton=b.byId(f,"IDButtonMoveToBottom");this._moveBottomButton.setTooltip(this.oResourceBundle.getText("p13nDialog.MOVE_TO_BOTTOM"));this._oSearchField=b.byId(f,"idSearchField");}.bind(this));},renderer:function(r,c){r.write("<div");r.writeControlData(c);r.writeClasses();r.write(">");r.renderControl(c.getAggregation("_content"));r.write("</div>");}});B.prototype.setTemplate=function(t){this.setAggregation("template",t);if(t){this._oSelectionBindingInfo=t.getBindingInfo("selected");if(this._oSelectionBindingInfo&&this._oSelectionBindingInfo.parts){this._oSelectionBindingInfo={parts:this._oSelectionBindingInfo.parts};}}if(this._oMTable){this._bindListItems();}return this;};B.prototype.setPanelColumns=function(t){var c;if(t instanceof Array){c=t;}else{c=[t];}if(this._oMTable){this._addTableColumns(c);}else{this._aColTexts=c;}};B.prototype._addTableColumns=function(t){t.forEach(function(s){this._oMTable.addColumn(new a({header:new T({text:s})}));},this);};B.prototype._bindListItems=function(m){var t=this.getTemplate();if(t){this._oMTable.bindItems(Object.assign({path:"/items",key:"name",templateShareable:false,template:this.getTemplate().clone()},m));}};B.prototype._onSelectionChange=function(e){var l=e.getParameter("listItems");var s=e.getParameter("selectAll");var d=!s&&l.length>1;l.forEach(function(t){this._selectTableItem(t,s||d);},this);if(s||d){this.fireChange();}if(d){this._moveTopButton.setEnabled(false);this._moveUpButton.setEnabled(false);this._moveDownButton.setEnabled(false);this._moveBottomButton.setEnabled(false);}};B.prototype._onItemPressed=function(e){var t=e.getParameter('listItem');this._oSelectedItem=t;this._updateEnableOfMoveButtons(t);};B.prototype._onSearchFieldLiveChange=function(e){this._oMTable.getBinding("items").filter(new F("label","Contains",e.getSource().getValue()));};B.prototype._onPressButtonMoveToTop=function(){this._moveSelectedItem(0);};B.prototype._onPressButtonMoveUp=function(){this._moveSelectedItem("Up");};B.prototype._onPressButtonMoveDown=function(){this._moveSelectedItem("Down");};B.prototype._onPressButtonMoveToBottom=function(){var i=this._oMTable.getItems().length-1;this._moveSelectedItem(i);};B.prototype._onPressShowSelected=function(e){this._togglePanelMode();};B.prototype._togglePanelMode=function(){this._bShowSelected=this._bShowSelected?false:true;this.getModel().setProperty("/mode",this._bShowSelected?this.oResourceBundle.getText("p13nDialog.SELECT"):this.oResourceBundle.getText("p13nDialog.REORDER"));if(this._bShowSelected){this._updateModelItems();}this.switchListMode(this._bShowSelected?"None":"MultiSelect");this._filterBySelected(this._bShowSelected);this._oSearchField.setVisible(!this._bShowSelected);this._oSearchField.setValue("");this._moveTopButton.setVisible(this._bShowSelected);this._moveUpButton.setVisible(this._bShowSelected);this._moveDownButton.setVisible(this._bShowSelected);this._moveBottomButton.setVisible(this._bShowSelected);};B.prototype._updateModelItems=function(){var f=this.getModel().getProperty("/items");var s=[],o=[];f.forEach(function(c){if(c.selected){s.push(c);}else{o.push(c);}});this.getModel().setProperty("/items",s.concat(o));};B.prototype._filterBySelected=function(s){this._oMTable.getBinding("items").filter(s?new F("selected","EQ",true):[]);};B.prototype.switchListMode=function(m){if(this._oSelectionBindingInfo){if(m==="None"){this.getTemplate().unbindProperty("selected");}else{this.getTemplate().bindProperty("selected",this._oSelectionBindingInfo);}this._oMTable.unbindAggregation("items");}this._oMTable.setMode(m);if(this._oSelectionBindingInfo){this._bindListItems();}};B.prototype._onDragEnter=function(e){if(!this._bShowSelected){e.preventDefault();}};B.prototype._selectTableItem=function(t,s){this._updateEnableOfMoveButtons(t);this._oSelectedItem=t;if(!s){this.fireChange();}};B.prototype._moveSelectedItem=function(n){var s=this._oSelectedItem;var S=this._oMTable.indexOfItem(s);if(S<0){return;}var N=(typeof n=="number")?n:S+(n=="Up"?-1:1);this._moveTableItem(s,N);};B.prototype._moveTableItem=function(i,n){var I=this._oMTable.getItems();var f=this._oMTable.getModel().getProperty("/items");var o=f.indexOf(i.getBindingContext().getObject());n=(n<=0)?0:Math.min(n,I.length-1);n=f.indexOf(I[n].getBindingContext().getObject());if(n==o){return;}f.splice(n,0,f.splice(o,1)[0]);this._oMTable.getModel().setProperty("/items",f);this._oSelectedItem=I[n];this._updateEnableOfMoveButtons(this._oSelectedItem);this.fireChange();};B.prototype._onRearrange=function(e){var d=e.getParameter("draggedControl");var D=e.getParameter("droppedControl");var s=e.getParameter("dropPosition");var i=this._oMTable.indexOfItem(d);var c=this._oMTable.indexOfItem(D);var A=c+(s=="Before"?0:1)+(i<c?-1:0);this._moveTableItem(d,A);};B.prototype._updateEnableOfMoveButtons=function(t){var i=this._oMTable.getItems().indexOf(t);var u=true,d=true;if(i==0){u=false;}if(i==this._oMTable.getItems().length-1){d=false;}this._moveTopButton.setEnabled(u);this._moveUpButton.setEnabled(u);this._moveDownButton.setEnabled(d);this._moveBottomButton.setEnabled(d);t.focus();};B.prototype.exit=function(){this._oSelectionBindingInfo=null;this._oSelectedItem=null;this._oMTable=null;this._moveTopButton=null;this._moveUpButton=null;this._moveDownButton=null;this._moveBottomButton=null;this._oSearchField=null;};return B;},true);
