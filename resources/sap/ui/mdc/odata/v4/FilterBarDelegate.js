/*
 * ! SAPUI5

		(c) Copyright 2009-2019 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/mdc/FilterBarDelegate","sap/ui/mdc/library",'sap/base/util/merge','sap/ui/mdc/FilterField',"sap/ui/core/format/DateFormat",'sap/ui/mdc/util/IdentifierUtil'],function(F,m,a,b,D,I){"use strict";var O=Object.assign({},F);var d={"Edm.Boolean":"Bool","Edm.Byte":"Int","Edm.DateTime":"Date","Edm.DateTimeOffset":"DateTimeOffset","Edm.Decimal":"Decimal","Edm.Double":"Float","Edm.Float":"Float","Edm.Guid":"Guid","Edm.Int16":"Int","Edm.Int32":"Int","Edm.Int64":"Int","Edm.SByte":"Int","Edm.Single":"Float","Edm.String":"String","Edm.Time":"TimeOfDay"};O._createFilterField=function(p,f){var o,v=null,s;s=I.getFilterFieldId(f,I.getPropertyKey(p));o=new b(s,{label:p.label,dataType:p.type,dataTypeConstraints:a({},p.constraints),dataTypeFormatOptions:a({},p.formatOptions),maxConditions:p.maxConditions,required:p.required,visible:true});o.bindProperty("conditions",{path:f._getConditionModelName()+">/conditions/"+I.getPropertyKey(p)},true);var V=p.filterConditions;if(V&&(V.length>0)){o.setConditions(V);}if(p.tooltip){o.setTooltip(p.tooltip);}v=p.fieldHelp;if(v){o.setFieldHelp(I.getView(f).createId(v));}var M=f._getConditionModel();if(M){o.setModel(M,f._getConditionModelName());}return o;};O._createFilter=function(p,f){return this.fetchProperties(f).then(function(P){var o=P.find(function(c){return((c.path===p)||(c.name===p));});if(!o){return null;}return Promise.resolve(this._createFilterField(o,f));}.bind(this));};O._fetchPropertiesXML=function(f,p){var M,c="ProductList";var o=p.appComponent.getModel(M);var e={getMetadataInfo:function(){return{modelName:M,collectionName:c};},getModel:function(){return o;}};return this.fetchProperties(e);};O._isMultiValue=function(p){var i=true;switch(p.filterExpression){case"SearchExpression":case"SingleRange":case"SingleValue":i=false;break;default:break;}return i;};O._createFilterFieldXML=function(p,f,P){var M=P.modifier;var n=p.path||p.name;var i=M.getControlIdBySelector(f,P.appComponent)+"--filter--"+I.replace(n);return M.createControl("sap.ui.mdc.FilterField",P.appComponent,P.view,i,{dataType:p.type,conditions:"{$filters>/conditions/"+n+'}',required:p.required,label:p.label,maxConditions:p.maxConditions},true).then(function(o){if(p.fieldHelp){M.setProperty(o,"fieldHelp",p.fieldHelp);}if(p.tooltip){M.setProperty(o,"tooltip",p.tooltip);}var c=p.constraints;if(c){M.setProperty(o,"dataTypeConstraints",c);}var e=p.formatOptions;if(e){M.setProperty(o,"dataTypeFormatOptions",e);}return o;});};O._createFilterXML=function(p,f,P){return this._fetchPropertiesXML(f,P).then(function(c){var o=c.find(function(C){return((C.path===p)||(C.name===p));});if(!o){return null;}return Promise.resolve(this._createFilterFieldXML(o,f,P));}.bind(this));};O.beforeAddFilterFlex=function(p,f,P){if(f.getModel){return Promise.resolve(this._createFilter(p,f));}return Promise.resolve(this._createFilterXML(p,f,P));};O.afterRemoveFilterFlex=function(f,o,p){return Promise.resolve(true);};O._getFieldGroupsByFilterFacetsAnnotation=function(M,e){};O._fetchProperties=function(M,e,p,n){var o,A,E,c,s;var N=[],r=[],S=[],f={},g={};var G,h;s='/'+e;E=M.getObject(s);if(E&&E.$NavigationPropertyBinding){g=E.$NavigationPropertyBinding;}G=e;h=M.getObject(s+'/'+"@com.sap.vocabularies.Common.v1.Label");if(!h&&n){h=G;}A=M.getObject(s+"@Org.OData.Capabilities.V1.FilterRestrictions");if(A){if(A.NonFilterableProperties){A.NonFilterableProperties.every(function(P){N.push(P.$PropertyPath);return true;});}if(A.RequiredProperties){A.RequiredProperties.every(function(P){r.push(P.$PropertyPath);return true;});}if(A.FilterExpressionType){A.FilterExpressionType.every(function(P){f[P.Property.$PropertyPath]=P.AllowedExpressions;return true;});}}A=M.getObject(s+"/"+"@com.sap.vocabularies.UI.v1.SelectionFields");if(A){A.every(function(P){S.push(P.$PropertyPath);return true;});}A=O._getFieldGroupsByFilterFacetsAnnotation(M,s);if(A){}var H,i,l,t,v,R,V,j,P,C,k;c=M.getObject(s+"/");for(var K in c){o=c[K];if(o){if(o.$kind==="Property"){if(N.indexOf(K)>=0){continue;}if(M.getObject(s+"/"+K+"@com.sap.vocabularies.UI.v1.Hidden")){continue;}H=false;if(M.getObject(s+"/"+K+"@com.sap.vocabularies.UI.v1.HiddenFilter")){H=true;}k=false;if(M.getObject(s+"/"+K+"@com.sap.vocabularies.Common.v1.IsDigitSequence")){k=true;}i=null;j=M.getObject(s+"/"+K+"@com.sap.vocabularies.Common.v1.FilterDefaultValue");if(j){v=j["$"+d[o.$Type]];switch(o.$Type){case"Edm.DateTimeOffset":i=v;break;default:i=v;}}R=(r.indexOf(K)>=0)?true:false;V=(S.indexOf(K)>=0)?true:false;l=M.getObject(s+"/"+K+"@com.sap.vocabularies.Common.v1.Label")||K;t=M.getObject(s+"/"+K+"@com.sap.vocabularies.Common.v1.QuickInfo")||null;if(o.$MaxLength||o.$Precision||o.$Scale||k){C={};if(o.$MaxLength){C.maxLength=o.$MaxLength;}if(o.$Precision){C.precision=o.$Precision;}if(o.$Scale){C.precision=o.$Scale;}if(k){C.isDigitSequence=k;}}else{C=null;}P={name:K,group:G,label:l,tooltip:t,type:o.$Type,required:R,hiddenFilter:H,visible:V};if(C){P.constraints=C;}if(i){P.defaultFilterConditions=[{fieldPath:K,operator:"EQ",values:[i]}];}if(f[K]){P.filterExpression=f[K];}else{P.filterExpression="auto";}P.maxConditions=this._isMultiValue(P)?-1:1;if(n){P.path=n+"/"+K;}if(h){P.groupLabel=h||null;}p.push(P);}else if(o.$kind==="NavigationProperty"){var q=g[K];if(q){O._fetchProperties(M,q,p,K);}}}}};O.fetchProperties=function(f){if(this._aProperties){Promise.resolve(this._aProperties);}var M=f.getMetadataInfo().modelName;var o=f.getModel(M?M:undefined);var e=f.getMetadataInfo().collectionName;return new Promise(function(r,c){var g,p=[];if(!o||!e){c("model or entity set name not available");return;}g=o.getMetaModel();if(!g){c("metadata model not available");}else{this._fetchProperties(g,e,p);this._aProperties=p;r(p);}}.bind(this));};return O;},false);
