/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["./Tool","./AnchorPointToolHandler","./AnchorPointToolGizmo","./AnchorPointToolOperation"],function(T,A,a,b){"use strict";var c=T.extend("sap.ui.vk.tools.AnchorPointTool",{metadata:{properties:{enableStepping:{type:"boolean",defaultValue:false},showEditingUI:{type:"boolean",defaultValue:false},allowOperation:{type:"sap.ui.vk.tools.AnchorPointToolOperation",defaultValue:b.All}},events:{moving:{parameters:{x:"float",y:"float",z:"float"}},moved:{parameters:{x:"float",y:"float",z:"float"}},rotating:{parameters:{x:"float",y:"float",z:"float"}},rotated:{parameters:{x:"float",y:"float",z:"float"}}}},constructor:function(i,s){T.apply(this,arguments);this._viewport=null;this._handler=new A(this);this._gizmo=null;}});c.prototype.init=function(){if(T.prototype.init){T.prototype.init.call(this);}this.setFootprint(["sap.ui.vk.threejs.Viewport"]);this.setAggregation("gizmo",new a());};c.prototype.isViewportType=function(t){if(this._viewport&&this._viewport.getMetadata().getName()===t){return true;}return false;};c.prototype.setActive=function(v,d,g){if(T.prototype.setActive){T.prototype.setActive.call(this,v,d,g);}if(d==null){d=this._viewport;}if(v){this._activateTool(d);}else{this._deactivateTool();}if(d){d.setShouldRenderFrame();}return this;};c.prototype._activateTool=function(d){this._viewport=this.getViewportImplementation(d);this._gizmo=this.getGizmo();if(this._gizmo){this._gizmo.show(this._viewport,this);}this._prepare();};c.prototype._deactivateTool=function(){if(this._viewport&&this._viewport._loco){this._viewport._loco.removeHandler(this._handler);}if(this._gizmo){this._gizmo.hide();this._gizmo=null;}};c.prototype._prepare=function(){var o=false;if(this._viewport._loco){this._viewport._loco.addHandler(this._handler,10);o=true;}return o;};c.prototype.queueCommand=function(d){if(this._prepare()){if(this.isViewportType("sap.ui.vk.threejs.Viewport")){d();}}return this;};c.prototype.setShowEditingUI=function(v){this.setProperty("showEditingUI",v,true);if(this._viewport){this._viewport.setShouldRenderFrame();}return this;};c.prototype.setAllowOperation=function(v){this.setProperty("allowOperation",v,true);if(this._gizmo){this._gizmo._updateHandlesVisibility();}if(this._viewport){this._viewport.setShouldRenderFrame();}return this;};c.prototype.move=function(x,y,z){if(this._gizmo){this._gizmo.move(x,y,z);}if(this._viewport){this._viewport.setShouldRenderFrame();}return this;};c.prototype.rotate=function(x,y,z){if(this._gizmo){this._gizmo.rotate(x,y,z);}if(this._viewport){this._viewport.setShouldRenderFrame();}return this;};c.prototype.moveTo=function(t,u){var n=Array.isArray(t)?t:[t];var p=new THREE.Vector3();if(u){var d=0;var e=new THREE.Vector3();n.forEach(function(g){p.add(e.setFromMatrixPosition(g.matrixWorld));d++;});p.multiplyScalar(1/d);}else{var f=new THREE.Box3();n.forEach(function(g){f.expandByObject(g);});f.getCenter(p);}this.getGizmo().setPosition(p);return this;};c.prototype.alignTo=function(n){var q=new THREE.Quaternion();if(n){n.matrixWorld.decompose(new THREE.Vector3(),q,new THREE.Vector3());}this.getGizmo().setQuaternion(q);return this;};c.prototype.alignToWorld=function(){this.getGizmo().setQuaternion(new THREE.Quaternion());return this;};c.prototype.alignToScreen=function(){if(this._viewport){var d=this._viewport.getCamera().getCameraRef();this.getGizmo().setQuaternion(d.quaternion);}return this;};return c;});
