/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/ui/core/Element","./Core","./ContentConnector","./Scene"],function(E,v,C,S){"use strict";var V=E.extend("sap.ui.vk.ViewManager",{metadata:{interfaces:["sap.ui.vk.IViewManager"],properties:{autoPlayAnimation:{type:"boolean",defaultValue:true},autoAdvanceViewTimeout:{type:"int",defaultValue:1000}},associations:{contentConnector:{type:"sap.ui.vk.ContentConnector"},animationPlayer:{type:"sap.ui.vk.AnimationPlayer"}}}});V.prototype._setScene=function(s){if(this._scene!==s){this._scene=s;if(this._scene){var i=s.getInitialView();if(i){this.activateView(i);}}}return this;};V.prototype.getScene=function(){return this._scene;};V.prototype.getActiveView=function(){return this._activeView;};V.prototype._setContent=function(c){var s=null;if(c&&c instanceof S){s=c;}this._setScene(s);};V.prototype._handleContentChangesFinished=function(){this._setContent(this._contentConnector.getContent());};V.prototype._onBeforeClearContentConnector=function(){this._setScene(null);};V.prototype.activateView=function(a){return this._activateView(a,null,!this.getAutoPlayAnimation(),false);};V.prototype.playViewGroup=function(a,b){this._cancelPlayingViewGroup=false;if(a===this.getActiveView()){var c=sap.ui.getCore().byId(this.getAnimationPlayer());if(c){if(!c.shoudAnimateNextFrame()){c.setTime(0);}}return this._autoPlay(a,b,false,true);}return this._activateView(a,b,false,true);};V.prototype.stopPlayingViewGroup=function(){this._cancelPlayingViewGroup=true;var a=sap.ui.getCore().byId(this.getAnimationPlayer());if(a){a.stop();}};V.prototype._autoPlay=function(a,b,s,c){var e=v.getEventBus();var d=sap.ui.getCore().byId(this.getAnimationPlayer());var f=function(){if(this._cancelPlayingViewGroup){return;}var n=this._getNextView(a,b);if(n){this._activateView(n,b,s,c);}}.bind(this);var o=function(h,i,j){if(j.source!==d){return;}if(j.stopped){e.unsubscribe("sap.ui.vk","animationPlayStateChanged",o,this);if(j.endOfAnimation){f();}}};var g=function(){if(c){if(d&&a.hasAnimation()){e.subscribe("sap.ui.vk","animationPlayStateChanged",o,this);}else{setTimeout(function(){f();},this.getAutoAdvanceViewTimeout());}}if((!s||c)&&a.hasAnimation()){if(d){d.play();}else{}}}.bind(this);g();};V.prototype._getNextView=function(a,b){var s=this.getScene();if(!b){b=s.findViewGroupByView(a);}var c;var i=-1;if(!b){c=s.getViews();i=c.indexOf(a);}else{c=b.getViews();i=b.indexOfView(a);}if(i<0){return undefined;}else if(i>=c.length-1){return undefined;}i++;return c[i];};V.prototype._activateView=function(a,b,s,c){var e=v.getEventBus();this._activeView=a;var o=function(d,f,g){if(g.view!==a){return;}e.unsubscribe("sap.ui.vk","readyForAnimation",o,this);this._autoPlay(a,b,s,c,true);}.bind(this);e.subscribe("sap.ui.vk","readyForAnimation",o,this);e.publish("sap.ui.vk","activateView",{source:this,view:a});return this;};C.injectMethodsIntoClass(V);return V;});
